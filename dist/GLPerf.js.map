{"version":3,"sources":["webpack://GLPerf/webpack/universalModuleDefinition","webpack://GLPerf/webpack/bootstrap","webpack://GLPerf/./log.ts","webpack://GLPerf/./Core.ts","webpack://GLPerf/./GLPerf.ts","webpack://GLPerf/./hooks/DrawCallHook.ts","webpack://GLPerf/./hooks/TextureHook.ts","webpack://GLPerf/./hooks/ShaderHook.ts","webpack://GLPerf/./Monitor.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","color","colorLog","args","console","log","_i","arguments","length","apply","concat","errorLog","error","DrawCallHook_1","TextureHook_1","ShaderHook_1","log_1","Core","canvas","this","samplingFrames","samplingIndex","gl","getContext","hook","drawCallHook","default","textureHook","shaderHook","reset","release","update","now","performance","delta","data","fps","Math","min","memory","usedJSHeapSize","drawCall","triangles","lines","points","textures","shaders","Core_1","Monitor_1","Monitor","DrawCallHook","realDrawElements","drawElements","realDrawArrays","drawArrays","hookedDrawElements","hookedDrawArrays","hooked","count","type","offset","first","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","LINES","LINE_STRIP","LINE_LOOP","POINTS","TextureHook","realCreateTexture","createTexture","realDeleteTexture","deleteTexture","hookedCreateTexture","hookedDeleteTexture","texture","ShaderHook","realAttachShader","attachShader","realDetachShader","detachShader","hookedAttachShader","hookedDetachShader","program","shader","core","items","createContainer","container","document","createElement","classList","add","innerHTML","appendChild","createStyle","body","doms","Array","slice","querySelectorAll","style","createTextNode","dom","this_1","item","requestAnimationFrame","innerText","destroy","removeChild"],"mappings":"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","file":"GLPerf.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"GLPerf\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"GLPerf\"] = factory();\n\telse\n\t\troot[\"GLPerf\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","const color = \"text-shadow: -1px -1px hsl(0,100%,50%), 1px 1px hsl(5.4, 100%, 50%), 3px 2px hsl(10.8, 100%, 50%), 5px 3px hsl(16.2, 100%, 50%), 7px 4px hsl(21.6, 100%, 50%), 9px 5px hsl(27, 100%, 50%), 11px 6px hsl(32.4, 100%, 50%), 13px 7px hsl(37.8, 100%, 50%), 14px 8px hsl(43.2, 100%, 50%), 16px 9px hsl(48.6, 100%, 50%), 18px 10px; font-size: 40px; color: #ffffff;\"\n\nexport function colorLog(args: any) {\n  console.log(`%c${args}`, color)\n}\n\nexport function log (...args: any) {\n  console.log('ðŸš€ [GLPerf]', ...args)\n}\n\nexport function errorLog (...args: any) {\n  console.error('ðŸš€ [GLPerf]', ...args)\n}","import DrawCallHook from \"./hooks/DrawCallHook\";\nimport TextureHook from \"./hooks/TextureHook\";\nimport ShaderHook from \"./hooks/ShaderHook\";\nimport {log, errorLog, colorLog} from './log'\n\ndeclare global {\n  interface Performance {\n    memory: any\n  }\n}\n\n/**\n * @class Core\n */\nexport default class Core{\n  private gl: WebGLRenderingContext\n  private drawCallHook: DrawCallHook\n  private textureHook: TextureHook\n  private shaderHook: ShaderHook\n  private samplingFrames: number = 60\n  private samplingIndex: number = 0\n  private now: number\n\n  constructor(canvas: HTMLCanvasElement) {\n    try {\n      this.gl = canvas.getContext('webgl')\n\n      if (this.gl) {\n        colorLog('Good Boy Play WebGL')\n      }\n    } catch (error) {\n      errorLog(`Can't get WebGL context.`)\n    }\n\n    if (this.gl) {\n      this.hook(this.gl)\n    }\n  }\n\n  private hook (gl: WebGLRenderingContext) {\n    this.drawCallHook = new DrawCallHook(gl)\n    this.textureHook = new TextureHook(gl)\n    this.shaderHook = new ShaderHook(gl)\n  }\n\n  public reset () {\n    this.drawCallHook && this.drawCallHook.reset()\n  }\n\n  public release () {\n    this.drawCallHook && this.drawCallHook.release()\n    this.textureHook && this.textureHook.release()\n    this.shaderHook && this.shaderHook.release()\n  }\n\n  public update () {\n    let now = performance.now()\n    let delta = now - this.now\n    this.now = now\n\n    if (this.samplingIndex !== this.samplingFrames) {\n      this.reset()\n      this.samplingIndex++\n      return\n    }\n\n    this.samplingIndex = 0\n\n    let data = {\n      fps: delta ? Math.min(60, 1000 / delta >> 0) : 0,\n      memory: performance.memory && performance.memory.usedJSHeapSize / 1048576 >> 0,\n      drawCall: this.drawCallHook.drawCall,\n      triangles: this.drawCallHook.triangles,\n      lines: this.drawCallHook.lines,\n      points: this.drawCallHook.points,\n      textures: this.textureHook.textures,\n      shaders: this.shaderHook.shaders\n    }\n\n    this.reset()\n\n    return data\n  }\n}","import Core from './Core'\nimport Monitor from './Monitor'\n\nexport { Monitor, Core }","import {log, errorLog} from '../log'\n\n/**\n * @class DrawCallHook\n */\nexport default class DrawCallHook {\n  public drawCall: number = 0\n  public triangles: number = 0\n  public lines: number = 0\n  public points: number = 0\n  private hooked: boolean\n  private realDrawElements: any\n  private realDrawArrays: any\n  private gl: WebGLRenderingContext\n\n  constructor (gl: WebGLRenderingContext) {\n    this.realDrawElements = gl.drawElements\n    this.realDrawArrays = gl.drawArrays\n\n    gl.drawElements = this.hookedDrawElements.bind(this)\n    gl.drawArrays = this.hookedDrawArrays.bind(this)\n\n    this.hooked = true\n    this.gl = gl\n\n    log(`DrawCall is hooked.`)\n  }\n\n  private hookedDrawElements (mode:number, count:number, type:number, offset:number) {\n    this.realDrawElements.call(this.gl, mode, count, type, offset)\n    this.update(count, mode)\n  }\n\n  private hookedDrawArrays (mode:number, first:number, count:number) {\n    this.realDrawArrays.call(this.gl, mode, first, count)\n    this.update(count, mode)\n  }\n\n\tprivate update(count: number, mode:number) {\n    const {gl} = this\n\n    this.drawCall++\n\n\t\tswitch ( mode ) {\n\t\t\tcase gl.TRIANGLES:\n\t\t\t\tthis.triangles += count / 3\n\t\t\t\tbreak\n\n\t\t\tcase gl.TRIANGLE_STRIP:\n\t\t\tcase gl.TRIANGLE_FAN:\n\t\t\t\tthis.triangles += count - 2\n\t\t\t\tbreak\n\n\t\t\tcase gl.LINES:\n\t\t\t\tthis.lines += count / 2\n\t\t\t\tbreak\n\n\t\t\tcase gl.LINE_STRIP:\n\t\t\t\tthis.lines += count - 1\n\t\t\t\tbreak\n\n\t\t\tcase gl.LINE_LOOP:\n\t\t\t\tthis.lines += count\n\t\t\t\tbreak\n\n\t\t\tcase gl.POINTS:\n\t\t\t\tthis.points += count\n\t\t\t\tbreak\n\n\t\t\tdefault:\n\t\t\t\terrorLog(`Unknown draw mode: ${mode}`)\n\t\t\t\tbreak\n\t\t}\n\t}\n\n  public reset (): void {\n    this.drawCall = 0\n    this.triangles = 0\n    this.lines = 0\n    this.points = 0\n  }\n\n  public release (): void {\n    if (this.hooked) {\n      this.gl.drawElements = this.realDrawElements\n      this.gl.drawArrays = this.realDrawArrays\n    }\n\n    this.hooked = false\n  }\n}","import {log, errorLog} from '../log'\n\n/**\n * @class TextureHook\n */\nexport default class TextureHook {\n  public textures: number = 0\n  private realCreateTexture: any\n  private realDeleteTexture: any\n  private hooked:boolean\n  private gl: WebGLRenderingContext\n\n  constructor (gl: WebGLRenderingContext) {\n    this.realCreateTexture = gl.createTexture\n    this.realDeleteTexture = gl.deleteTexture\n\n    gl.createTexture = this.hookedCreateTexture.bind(this)\n    gl.deleteTexture = this.hookedDeleteTexture.bind(this)\n\n    this.hooked = true\n    this.gl = gl\n\n    log(`Texture is hooked.`)\n  }\n\n  private hookedCreateTexture() {\n    let texture = this.realCreateTexture.call(this.gl)\n\n    this.textures++\n\n    log(`CreateTexture:`, texture, `textures: ${this.textures}`)\n\n    return texture\n  }\n\n  private hookedDeleteTexture(texture:any) {\n    this.realDeleteTexture.call(this.gl, texture)\n\n    this.textures--\n\n    log(`DeleteTexture. textures: ${this.textures}`)\n  }\n\n  public reset () {\n    this.textures = 0\n  }\n\n  public release () {\n    if (this.hooked) {\n      this.gl.createTexture = this.realCreateTexture\n      this.gl.deleteTexture = this.realDeleteTexture\n    }\n\n    this.hooked = false\n  }\n}","import {log, errorLog} from '../log'\n\n/**\n * @class ShaderHook\n */\nexport default class ShaderHook {\n  public shaders: number = 0\n  private realAttachShader: any\n  private realDetachShader: any\n  private hooked:boolean\n  private gl: WebGLRenderingContext\n\n  constructor (gl: WebGLRenderingContext) {\n    this.realAttachShader = gl.attachShader\n    this.realDetachShader = gl.detachShader\n\n    gl.attachShader = this.hookedAttachShader.bind(this)\n    gl.detachShader = this.hookedDetachShader.bind(this)\n\n    this.hooked = true\n    this.gl = gl\n\n    log(`Shader is hooked.`)\n  }\n\n  private hookedAttachShader(program:any, shader:any) {\n    this.realAttachShader.call(this.gl, program, shader)\n\n    this.shaders++\n\n    log(`AttachShader:`, shader, `shaders: ${this.shaders}`)\n  }\n\n  private hookedDetachShader(program:any, shader:any) {\n    this.realDetachShader.call(this.gl, program, shader)\n\n    this.shaders--\n\n    log(`DetachShader. shaders: ${this.shaders}`)\n  }\n\n  public reset () {\n    this.shaders = 0\n  }\n\n  public release () {\n    if (this.hooked) {\n      this.gl.attachShader = this.realAttachShader\n      this.gl.detachShader = this.realDetachShader\n    }\n\n    this.hooked = false\n  }\n}","import Core from './Core'\n\nlet tpl = `\n  <dl>\n    <dt>FPS</dt>\n    <dd>0</dd>\n    <dt>Memory <span class=\"unit\">(MB)</span></dt>\n    <dd>0</dd>\n    <dt>DrawCall</dt>\n    <dd>0</dd>\n    <dt>Triangles</dt>\n    <dd>0</dd>\n    <dt>Textures</dt>\n    <dd>0</dd>\n    <dt>Shaders</dt>\n    <dd>0</dd>\n  </dl>\n`\nlet css = `\n  .gl-perf {\n    pointer-events: none;\n    user-select: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    padding: ${20/7.5}vw ${20/7.5}vw 0 ${20/7.5}vw;\n    background: rgba(0, 0, 0, 0.3);\n    color: #fff;\n    font: ${20/7.5}vw arial;\n  }\n\n  .gl-perf dl,\n  .gl-perf dt,\n  .gl-perf dd {\n    padding: 0;\n    margin: 0;\n  }\n\n  .gl-perf dt {\n    color: orange;\n  }\n\n  .gl-perf dt .unit{\n    font-size: ${15/7.5}vw;\n  }\n\n  .gl-perf dd {\n    font-size: ${40/7.5}vw;\n    padding: ${10/7.5}vw 0 ${20/7.5}vw;\n  }\n`\n\nexport default class Monitor {\n  private core: Core\n  private doms: HTMLElement[] \n  private items: string[]\n  private container: HTMLElement\n\n  constructor (canvas:HTMLCanvasElement) {\n    this.core = new Core(canvas)\n    this.items = []\n    this.items = ['fps', 'memory', 'drawCall', 'triangles', 'textures', 'shaders']\n    this.createContainer()\n    this.update = this.update.bind(this)\n  }\n  \n  private createContainer() {\n    let container = document.createElement('div')\n    container.classList.add('gl-perf')\n    container.innerHTML = tpl\n\n    container.appendChild(this.createStyle())\n  \n    document.body.appendChild(container)\n\n    this.doms = Array.prototype.slice.apply(container.querySelectorAll('dd'))\n    this.container = container\n  }\n\n  private createStyle () {\n    let style:HTMLStyleElement = document.createElement('style')\n\n    style.type = 'text/css'\n\n    style.appendChild(document.createTextNode(css));\n\n    return style\n  }\n\n  /**\n   * Update per frame\n   */\n  public update () {\n    let data = this.core.update()\n\n    if (data) {\n      for (let i = 0, l = this.items.length; i < l; i++) {\n        let dom = this.doms[i]\n        let item = this.items[i]\n        let value = data[item] || 0\n\n        // see: http://wilsonpage.co.uk/preventing-layout-thrashing/\n        requestAnimationFrame(() => {\n          dom.innerText = value\n        })\n      }\n    }\n  }\n  \n  /**\n   * reset all hooks\n   */\n  public reset () {\n    this.core.reset()\n  }\n\n  /**\n   * release all hooks\n   */\n  public release () {\n    this.core.release()\n  }\n\n  /**\n   * destory the instance\n   */\n  public destroy () {\n    this.release()\n    document.body.removeChild(this.container)\n  }\n}"],"sourceRoot":""}